<form class="well form-inline">
    <h4>
      Try typing "Micro" or "GE":
      <small class="pull-right">Data from <a href="http://dev.markitondemand.com/MODApis/" target="_blank">markit on demand Data Apis v2</a></small>
    </h4>
    <input type="text" ng-model="asyncSelected" placeholder="Enter company name or symbol" uib-typeahead="symbol as symbol.Name+' ('+symbol.Exchange+')' for symbol in getSymbol($viewValue)" typeahead-loading="loadingSymbols" typeahead-no-results="noResults" class="form-control" ng-model-options="modelOptions" size=50>
    <i ng-show="loadingSymbols" class="glyphicon glyphicon-refresh"></i>
    <div ng-show="noResults">
      <i class="glyphicon glyphicon-remove"></i> No Results Found
    </div>
    <div ng-show="portfolio.hasOwnProperty(asyncSelected.Symbol)" class="alert alert-warning">
      Already in portfolio
    </div>

    <div ng-show="!noResults && !loadingSymbols && asyncSelected.Exchange">
      <pre>Model: {{asyncSelected | json}}</pre>
      <button class="btn btn-primary" ng-click="add()" ng-disabled="portfolio.hasOwnProperty(asyncSelected.Symbol)">
        <span class="glyphicon glyphicon-plus"></span>
      </button>
    </div>
</form>

<div>Portfolio VaR 95%: {{100*portfolioVaR(95)|number:2}} %</div>

<div>
  <table class="table" ng-show="portfolio">
    <tr>
      <th>&nbsp;</th>
      <th>Symbol</th>
      <th>Name</th>
      <th>Exchange</th>
      <th>History</th>
      <th>&nbsp;</th>
      <th>&nbsp;</th>
      <th>&nbsp;</th>
      <th>
        VaR (95%)
        &nbsp;
        based on <a href="https://gist.github.com/deenar/f97d517d3188fc7b5302" target="_blank">this</a>
      </th>
    </tr>
    <tbody ng-repeat="p in portfolio">
      <tr>
        <td><input type="checkbox" ng-model="p.selected" /></td>
        <td>{{p.symbol.Symbol}}</td>
        <td>{{p.symbol.Name}}</td>
        <td>{{p.symbol.Exchange}}</td>
        <td>
          <div>{{p.history.length}} points</div>
          <div>{{p.historyMeta.mindate}} .. {{p.historyMeta.maxdate}}</div>
        </td>
        <td>
          <div jq-sparkline ng-model="p.pnlsEdf" type="bar" ng-if="p.pnlsEdf"></div>
        </td>
        <td>
          <div>
            <a href="http://www.reuters.com/finance/stocks/chart?symbol={{p.symbol.Symbol}}" target="_blank">Source</a>
          </div>
          <div>
            <button class="btn btn-xs btn-info" ng-click="showChart(p)">
              ...
            </button>
          </div>
        </td>
        <td>
          <button class="btn btn-xs" ng-click="getChart(p)">
            <span class="glyphicon glyphicon-refresh"></span>
          </button>
          <button class="btn btn-danger btn-xs" ng-click="remove(p)">
            <span class="glyphicon glyphicon-remove"></span>
          </button>
        </td>
        <td>
          {{100*calculateVaR(p,95)|number:2}} %
        </td>
      </tr>
      <tr>
        <td colspan=9>
          <div jq-sparkline ng-model="p.history2" type="line" ng-if="p.history2"></div>
        </td>
      </tr>
    </tbody>
  </table>

  <button ng-click="clearAll()" class="btn btn-danger">Clear</button>
</div>
